## 1. SKU基础管理接口

### 创建SKU
POST /api/v1/skus
Content-Type: application/json

{
  "name": "高级游戏套装",
  "description": "包含基础游戏和所有DLC",
  "appids": ["123456", "789012", "345678"],
  "status": "active",
  "type": "bundle",
  "metadata": {
    "releaseDate": "2025-01-15",
    "publisher": "Example Games"
  }
}

### 更新SKU
PUT /api/v1/skus/{sku_id}
Content-Type: application/json

{
  "name": "豪华游戏套装",
  "description": "包含基础游戏和所有DLC与额外内容",
  "appids": ["123456", "789012", "345678", "901234"],
  "status": "active"
}

### 获取单个SKU
GET /api/v1/skus/{sku_id}

### 获取所有SKU（支持分页和过滤）
GET /api/v1/skus?page=1&limit=20&status=active&type=bundle

### 删除SKU
DELETE /api/v1/skus/{sku_id}

### 获取SKU变更事件记录
GET /api/v1/skus/{sku_id}/history


## 2. 价格管理接口

### 设置基础价格（多货币支持）
POST /api/v1/skus/{sku_id}/prices
Content-Type: application/json

{
  "base_prices": [
    {"currency": "USD", "amount": 19.99},
    {"currency": "EUR", "amount": 17.99},
    {"currency": "CNY", "amount": 138.00},
    {"currency": "JPY", "amount": 2200}
  ],
  "effective_from": "2025-04-01T00:00:00Z"
}

### 获取SKU价格（所有货币）
GET /api/v1/skus/{sku_id}/prices

### 获取特定货币的SKU价格
GET /api/v1/skus/{sku_id}/prices?currency=USD

### 批量更新SKU价格
PUT /api/v1/skus/{sku_id}/prices
Content-Type: application/json

{
  "base_prices": [
    {"currency": "USD", "amount": 24.99},
    {"currency": "EUR", "amount": 22.99}
  ],
  "effective_from": "2025-05-01T00:00:00Z"
}

### 价格历史查询
GET /api/v1/skus/{sku_id}/prices/history?currency=USD&from=2025-01-01&to=2025-03-31


## 3. 区域折扣管理接口
### 创建区域折扣活动
POST /api/v1/promotions
Content-Type: application/json

{
  "name": "春节特惠",
  "description": "亚太地区春节特别折扣",
  "type": "regional_discount",
  "start_date": "2025-02-10T00:00:00Z",
  "end_date": "2025-02-17T23:59:59Z",
  "regions": ["CN", "JP", "KR", "TW", "SG"],
  "discount_type": "percentage",
  "discount_value": 25,
  "applicable_skus": ["sku123", "sku456", "sku789"],
  "minimum_purchase": null,
  "coupon_code": null,
  "stackable": false,
  "max_uses_per_user": null
}

### 获取促销活动列表
GET /api/v1/promotions?status=active&type=regional_discount

### 获取特定促销活动
GET /api/v1/promotions/{promotion_id}

### 更新促销活动
PUT /api/v1/promotions/{promotion_id}
Content-Type: application/json

{
  "description": "亚太地区春节延长特别折扣",
  "end_date": "2025-02-24T23:59:59Z",
  "discount_value": 30
}

### 取消促销活动
DELETE /api/v1/promotions/{promotion_id}

### 将SKU添加到促销活动
POST /api/v1/promotions/{promotion_id}/skus
Content-Type: application/json

{
  "sku_ids": ["sku999", "sku888"]
}

### 从促销活动移除SKU
DELETE /api/v1/promotions/{promotion_id}/skus/{sku_id}


## 4. 价格计算接口
### 获取特定SKU在特定地区和货币的最终价格
GET /api/v1/skus/{sku_id}/calculated-price?region=CN&currency=CNY&user_id=12345

### 批量获取SKU的最终价格
POST /api/v1/calculated-prices
Content-Type: application/json

{
  "sku_ids": ["sku123", "sku456"],
  "region": "US",
  "currency": "USD",
  "user_id": "12345",
  "platform": "steam"
}

###
## 5. 汇率和税率管理接口
### 设置或更新汇率
PUT /api/v1/exchange-rates
Content-Type: application/json

{
  "base_currency": "USD",
  "rates": {
    "EUR": 0.91,
    "CNY": 6.95,
    "JPY": 110.5
  },
  "effective_date": "2025-03-18"
}

### 获取当前汇率
GET /api/v1/exchange-rates?base=USD

### 获取历史汇率
GET /api/v1/exchange-rates/history?base=USD&target=CNY&from=2025-01-01&to=2025-03-31

## 6. 税率
### 设置地区税率
POST /api/v1/tax-rates
Content-Type: application/json

{
  "region": "CA",
  "country": "Canada",
  "tax_rates": [
    {
      "type": "VAT",
      "rate": 5.0,
      "applies_to": ["digital_goods", "subscriptions"]
    },
    {
      "type": "Provincial Tax",
      "rate": 8.0,
      "province": "Ontario",
      "applies_to": ["digital_goods"]
    }
  ],
  "effective_from": "2025-04-01T00:00:00Z"
}

### 获取地区税率信息
GET /api/v1/tax-rates?country=Canada&province=Ontario



## 7. 捆绑包价格规则接口
### 创建捆绑包价格规则
POST /api/v1/skus/{sku_id}/bundle-rules
Content-Type: application/json

{
  "rule_type": "dynamic_discount",
  "discount_type": "percentage",
  "calculation": "sum_with_discount",
  "discount_value": 15,
  "min_items": 2,
  "description": "购买两个或以上商品可享受15%折扣"
}

### 获取捆绑包价格规则
GET /api/v1/skus/{sku_id}/bundle-rules


## 8. 用户个人化定价接口
### 设置用户个人优惠
POST /api/v1/users/{user_id}/personalized-offers
Content-Type: application/json

{
  "description": "忠实用户回归优惠",
  "eligible_skus": ["sku123", "sku456", "sku789"],
  "discount_type": "percentage",
  "discount_value": 20,
  "start_date": "2025-03-20T00:00:00Z",
  "end_date": "2025-04-03T23:59:59Z",
  "max_uses": 1
}

### 获取用户特价列表
GET /api/v1/users/{user_id}/personalized-offers?status=active


## 9. 批量价格操作接口
### 批量设置SKU价格
POST /api/v1/bulk/prices
Content-Type: application/json

{
  "sku_ids": ["sku123", "sku456", "sku789"],
  "operation": "increase_percentage",
  "value": 10,
  "currencies": ["USD", "EUR"],
  "effective_from": "2025-04-15T00:00:00Z"
}

### 批量创建促销
POST /api/v1/bulk/promotions
Content-Type: application/json

{
  "name_template": "夏季促销: {category}",
  "categories": ["RPG", "Strategy", "Simulation"],
  "discount_type": "percentage",
  "discount_values": {
    "RPG": 30,
    "Strategy": 25,
    "Simulation": 20
  },
  "start_date": "2025-06-15T00:00:00Z",
  "end_date": "2025-06-30T23:59:59Z",
  "regions": ["global"]
}


###

## 10. 根据AppID查询SKU
### 获取包含特定AppID的所有SKU
GET /api/v1/appids/{appid}/skus?status=active&page=1&limit=20

### 响应示例
#{
#  "total_count": 12,
#  "page": 1,
#  "limit": 20,
#  "skus": [
#    {
#      "id": "sku123",
#      "name": "豪华游戏套装",
#      "description": "包含基础游戏和所有DLC与额外内容",
#      "appids": ["123456", "789012", "345678"],
#      "status": "active",
#      "type": "bundle",
#      "created_at": "2025-01-15T10:30:00Z",
#      "updated_at": "2025-03-10T14:25:10Z",
#      "_links": {
#        "self": "/api/v1/skus/sku123",
#        "prices": "/api/v1/skus/sku123/prices",
#        "promotions": "/api/v1/skus/sku123/promotions"
#      }
#    },
#    {
#      "id": "sku456",
#      "name": "入门游戏包",
#      "description": "包含基础游戏和初级DLC",
#      "appids": ["123456", "789012"],
#      "status": "active",
#      "type": "bundle",
#      "created_at": "2025-01-20T09:15:00Z",
#      "updated_at": "2025-02-28T11:45:22Z",
#      "_links": {
#        "self": "/api/v1/skus/sku456",
#        "prices": "/api/v1/skus/sku456/prices",
#        "promotions": "/api/v1/skus/sku456/promotions"
#      }
#    }
#    // 更多SKU...
#  ]
#}

## 11. 批量更新(下架)包含特定AppID的SKU
### 更新所有包含特定AppID的SKU状态
PUT /api/v1/appids/{appid}/skus/batch-update
Content-Type: application/json

{
  "operation": "update_status",
  "status": "inactive",
  "reason": "appid_delisted",
  "notify_customers": true,
  "metadata": {
    "delisted_at": "2025-03-18T02:19:38Z",
    "delisted_by": "RightFS",
    "internal_ticket": "DL-20250318-001"
  }
}

### 响应示例
#{
#  "affected_skus_count": 12,
#  "affected_skus": [
#    {
#      "id": "sku123",
#      "name": "豪华游戏套装",
#      "previous_status": "active",
#      "current_status": "inactive",
#      "updated_at": "2025-03-18T02:20:15Z"
#    },
#    {
#      "id": "sku456",
#      "name": "入门游戏包",
#      "previous_status": "active",
#      "current_status": "inactive",
#      "updated_at": "2025-03-18T02:20:15Z"
#    }
#    // 更多被更新的SKU...
#  ],
#  "job_id": "job-batch-update-20250318-123456",
#  "_links": {
#    "job_status": "/api/v1/jobs/job-batch-update-20250318-123456"
#  }
#}


## 12. 批量替换特定AppID

### 批量替换SKU中的特定AppID
PUT /api/v1/appids/{old_appid}/replace
Content-Type: application/json

{
  "new_appid": "567890",
  "operation_type": "replace", // 可选值: replace, remove
  "reason": "版本升级",
  "metadata": {
    "requested_at": "2025-03-18T02:19:38Z",
    "requested_by": "RightFS"
  },
  "apply_to_sku_status": ["active", "inactive"] // 仅应用于这些状态的SKU
}

### 响应示例
#{
#  "affected_skus_count": 8,
#  "job_id": "job-replace-appid-20250318-789012",
#  "_links": {
#    "job_status": "/api/v1/jobs/job-replace-appid-20250318-789012"
#  }
#}

## 13. 任务状态查询
### 获取批量操作作业状态
GET /api/v1/jobs/{job_id}

### 响应示例
#{
#  "job_id": "job-batch-update-20250318-123456",
#  "type": "batch_update_skus",
#  "status": "completed", // pending, processing, completed, failed
#  "created_at": "2025-03-18T02:20:00Z",
#  "updated_at": "2025-03-18T02:21:30Z",
#  "progress": {
#    "total": 12,
#    "processed": 12,
#    "succeeded": 12,
#    "failed": 0
#  },
#  "details": {
#    "appid": "123456",
#    "operation": "update_status",
#    "new_status": "inactive"
#  },
#  "results": {
#    "successful_skus": ["sku123", "sku456", ...],
#    "failed_skus": []
#  },
#  "_links": {
#    "affected_skus": "/api/v1/jobs/job-batch-update-20250318-123456/skus"
#  }
#}

## 14. AppID关联管理

### 获取AppID的关联信息
GET /api/v1/appids/{appid}/associations

### 响应示例
#{
#  "appid": "123456",
#  "name": "示例游戏",
#  "status": "active",
#  "associated_skus_count": 12,
#  "associated_skus_summary": {
#    "by_status": {
#      "active": 10,
#      "inactive": 2
#    },
#    "by_type": {
#      "bundle": 8,
#      "single": 2,
#      "subscription": 2
#    }
#  },
#  "_links": {
#    "skus": "/api/v1/appids/123456/skus",
#    "prices": "/api/v1/appids/123456/prices",
#    "promotions": "/api/v1/appids/123456/promotions"
#  }
#}


# curl --location --request POST 'http://dev-api-game.nn.com/user/api/v1/auth/login'
#--header 'Content-Type: application/json'
#--data-raw '{
#  "clientId": 1,
#  "grantType": "sms",
#  "tenantNo": "000000",
#  "telNum": "13800138001",
#  "smsCode": "8888"
#}'
POST http://dev-api-game.nn.com/user/api/v1/auth/login
Content-Type: application/json

{
  "clientId": 1,
  "grantType": "sms",
  "tenantNo": "000000",
  "telNum": "13800138001",
  "smsCode": "8888"
}

###

